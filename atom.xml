<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://Diomchen.github.io</id>
    <title>DiomChen&apos;s Blog</title>
    <updated>2021-07-21T11:29:28.963Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://Diomchen.github.io"/>
    <link rel="self" href="https://Diomchen.github.io/atom.xml"/>
    <subtitle>å¿™è¶ä¸œé£æ”¾çº¸é¸¢ã€‚</subtitle>
    <logo>https://Diomchen.github.io/images/avatar.png</logo>
    <icon>https://Diomchen.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, DiomChen&apos;s Blog</rights>
    <entry>
        <title type="html"><![CDATA[ğŸŒneo4j]]></title>
        <id>https://Diomchen.github.io/post/neo4j/</id>
        <link href="https://Diomchen.github.io/post/neo4j/">
        </link>
        <updated>2021-07-19T11:33:40.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>é«˜æ€§èƒ½NoSqlå›¾å½¢æ•°æ®åº“</p>
</blockquote>
<h2 id="ç¯å¢ƒè¦æ±‚">ç¯å¢ƒè¦æ±‚</h2>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210708104701348.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="https://img-blog.csdnimg.cn/20200829111337351.png" alt="" loading="lazy"></figure>
<h2 id="åŸºæœ¬å®šä¹‰">åŸºæœ¬å®šä¹‰</h2>
<h3 id="1å›¾åƒæ•°æ®ç»“æ„">1.å›¾åƒæ•°æ®ç»“æ„</h3>
<p>Nodesï¼ˆèŠ‚ç‚¹ï¼‰</p>
<p>Relationshipsï¼ˆå…³ç³»ï¼‰</p>
<h2 id="dockerå®‰è£…éƒ¨ç½²">ğŸ‹dockerå®‰è£…éƒ¨ç½²</h2>
<p>æ‹‰å–æœ€æ–°çš„neo4jé•œåƒ</p>
<p>docker pull neo4j</p>
<p>è¿è¡ŒNeo4j å®¹å™¨</p>
<p>docker run -it -d -p 7474:7474 -p 7687:7687 neo4j:latest</p>
<p>æ‰“å¼€Neo4j æµè§ˆå™¨ç®¡ç†ç•Œé¢</p>
<p>http://localhost:7474</p>
<p>è®¾ç½®dataå’Œimport</p>
<p>dataç”¨äºæ•°æ®å­˜æ”¾</p>
<p>importç”¨äºå¯¼å…¥æ•°æ®ï¼ˆcsvæ–‡ä»¶ï¼‰</p>
<pre><code class="language-bash">docker run -it -d -p 7474:7474 -p 7687:7687 neo4j -v /home/user/Desktop/import:/var/lib/neo4j/import -v /home/user/Desktop/data:/data
</code></pre>
<h2 id="æœåŠ¡å™¨éƒ¨ç½²">ğŸ–¥æœåŠ¡å™¨éƒ¨ç½²</h2>
<ol>
<li>é¦–å…ˆæ˜¯ä¸‹è½½è§£å‹ communityç‰ˆæœ¬</li>
<li>æ›´æ”¹ /conf/neo4j.confæ–‡ä»¶</li>
</ol>
<pre><code class="language-shell"># With default configuration Neo4j only accepts local connections.
# To accept non-local connections, uncomment this line:
#ç‰¹åˆ«æ³¨æ„ï¼šé»˜è®¤æ˜¯æ³¨é‡Šçš„ï¼Œä¸å¼€å¯ï¼Œå¤–ç½‘ä¸èƒ½è®¿é—®webç«¯å£neo4j
dbms.default_listen_address=0.0.0.0

# You can also choose a specific network interface, and configure a non-default
# port for each connector, by setting their individual listen_address.

# The address at which this server can be reached by its clients. This may be the server's IP address or DNS name, or
# it may be the address of a reverse proxy which sits in front of the server. This setting may be overridden for
# individual connectors below.
#dbms.default_advertised_address=localhost

# You can also choose a specific advertised hostname or IP address, and
# configure an advertised port for each connector, by setting their
# individual advertised_address.

# By default, encryption is turned off.
# To turn on encryption, an ssl policy for the connector needs to be configured
# Read more in SSL policy section in this file for how to define a SSL policy.

# Bolt connector
dbms.connector.bolt.enabled=true
#dbms.connector.bolt.tls_level=DISABLED
dbms.connector.bolt.listen_address=0.0.0.0:7687
#dbms.connector.bolt.advertised_address=:7687

# HTTP Connector. There can be zero or one HTTP connectors.
dbms.connector.http.enabled=true
dbms.connector.http.listen_address=0.0.0.0:7474
#dbms.connector.http.advertised_address=:7474

# HTTPS Connector. There can be zero or one HTTPS connectors.
dbms.connector.https.enabled=false
dbms.connector.https.listen_address=0.0.0.0:7473
#dbms.connector.https.advertised_address=:7473
</code></pre>
<ol start="3">
<li>å¯åŠ¨neo4j</li>
</ol>
<pre><code class="language-bash">./bin/neo4j
</code></pre>
<blockquote>
<p>å‚è€ƒèµ„æ–™</p>
<p><a href="https://blog.csdn.net/mathew_leung/article/details/101838350">centos7 æœåŠ¡å™¨å®‰è£…neo4jå¹¶å®ç°è¿œç¨‹è®¿é—®</a></p>
</blockquote>
<h2 id="quickstart">ğŸ’¨QuickStart</h2>
<h3 id="å•ä¸ªæ“ä½œçš„æµç¨‹çº¯æ‰‹åŠ¨è¿æ¥">å•ä¸ªæ“ä½œçš„æµç¨‹ï¼ˆçº¯æ‰‹åŠ¨è¿æ¥ï¼‰</h3>
<pre><code class="language-java">//è®¾ç½®driver
Driver driver = GraphDatabase.driver(&quot;bolt://192.168.216.131:7687&quot;, AuthTokens.basic(&quot;neo4j&quot;, &quot;123456&quot; ));

//æ‰“å¼€session
Session session = driver.session();

//æ‰§è¡Œè¯­å¥
String cql = &quot;create (n:Person{name:$name,title:$title})&quot;;
            String insert_test_str = session.writeTransaction(new TransactionWork&lt;String&gt;() {
                @Override
                public String execute(Transaction tx) {
                    Result result = tx.run(cql,parameters(&quot;name&quot;,&quot;diomchen&quot;,&quot;title&quot;,&quot;The Code Hero&quot;));
                    return &quot;Create Node OK!&quot;;
                }
            });

//å…³é—­session
session.close();

//å…³é—­driver
driver.close();
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210708141036413.png" alt="" loading="lazy"></figure>
<h3 id="å•ä¸ªæ“ä½œçš„æµç¨‹æ•´åˆspringboot">å•ä¸ªæ“ä½œçš„æµç¨‹ï¼ˆæ•´åˆSpringbootï¼‰</h3>
<pre><code class="language-yml">#é¦–å…ˆæ˜¯æ•°æ®åº“çš„é…ç½®
    neo4j:
      uri: bolt://&lt;host&gt;:7687
      username: neo4j
      password: 123456
</code></pre>
<p><strong>mongoæ•°æ®åº“å¯¹è±¡</strong></p>
<pre><code class="language-java">@Data
@Document(collection = &quot;addresstxs&quot;)
public class Addresstxs {
    @Id
    private String id;

    @Field(&quot;address&quot;)
    private String address;
    @Field(&quot;height&quot;)
    private Integer height;
    @Field(&quot;index&quot;)
    private Integer index;
    @Field(&quot;txid&quot;)
    private String txid;
    @Field(&quot;type&quot;)
    private Integer type;

}
</code></pre>
<p><strong>neo4jæ•°æ®åº“å¯¹è±¡</strong></p>
<pre><code class="language-java">@Data
@Node(labels = {&quot;Addresstxs&quot;})
public class NAddresstxs {
//    //è‡ªåŠ¨ç”Ÿæˆid
//    @Id @GeneratedValue
//    private Long id;

    //äº¤æ˜“åœ°å€è¡¨Id
    @Id
    private String addresstxsId;

    //äº¤æ˜“åœ°å€
    @Property(name =&quot;address&quot;)
    private String address;

    @Property(name=&quot;height&quot;)
    private Integer height;

    @Property(name=&quot;index&quot;)
    private Integer index;

    @Property(name=&quot;txid&quot;)
    private String txid;


    //äº¤æ˜“ç±»å‹ï¼š1.è¾“å…¥äº¤æ˜“ 2.è¾“å‡ºäº¤æ˜“ 3.åŒä¸€äº¤æ˜“
    @Property(name = &quot;type&quot;)
    private Integer type;




}

</code></pre>
<p><strong>Daoå±‚</strong></p>
<pre><code class="language-java">@Repository
public interface AddresstxsRepository extends Neo4jRepository&lt;NAddresstxs,String&gt; {

    @Query(&quot;create (n:Addresstxs{ addresstxsId:$addresstxsId , address:$address , type:$type}) return n&quot;)
    List&lt;NAddresstxs&gt; addAddresstxs(@Param(&quot;addresstxsId&quot;) String addresstxsId, @Param(&quot;address&quot;) String address, @Param(&quot;type&quot;) Integer type);

    @Query(&quot;match (n) return n&quot;)
    List&lt;NAddresstxs&gt; getAddresstxs();
    /*
    	ç‰¹åˆ«éœ€è¦æ³¨æ„è¿”å›çš„ç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥ä»¥ä¸‹é—®é¢˜
    */


}
</code></pre>
<p><mark>è§£å†³åŠæ³•ï¼šçœ‹çœ‹è¿”å›ç±»å‹æ˜¯å¦å’Œ Neo4j Node èŠ‚ç‚¹ä¸€è‡´</mark></p>
<p><strong>Serviceå±‚</strong></p>
<pre><code class="language-java">public interface AddresstxsService {    //åˆ›å»ºAddresstxsèŠ‚ç‚¹    int createAddresstxsNode(Addresstxs addresstxs);    //getAddresstxs    List&lt;NAddresstxs&gt; getAddr();}@Service@Transactionalpublic class AddresstxsServiceImpl implements AddresstxsService{    @Resource    private AddresstxsRepository addresstxsRepository;    	......}
</code></pre>
<p><mark>neo4j 3.x å’Œ 4.x ç‰ˆæœ¬å­˜åœ¨è¾ƒå¤§ä¸åŒ</mark></p>
<pre><code class="language-java">//javaä¸­cql(3.x)String cql = &quot;create (n:Person{name:{name},title:{title}})&quot;;//javaä¸­cql(4.x)String cql = &quot;create (n:Person{name:$name,title:$title})&quot;;    
</code></pre>
<h2 id="å…³äºæ•°æ®å¤„ç†æˆå¯å¯¼å…¥csvç›¸å…³è§„èŒƒ">å…³äºæ•°æ®å¤„ç†æˆå¯å¯¼å…¥csvç›¸å…³è§„èŒƒ</h2>
<blockquote>
<ul>
<li>ä¸€ä¸ªæ•°æ®é›†å¿…é¡»åŒ…å« node å’Œ relationship</li>
<li>æ¯ä¸ªæ–‡ä»¶å¤´è¡Œéƒ½å¿…é¡»æè¿°æ•°æ®</li>
<li>å³ä½¿æ˜¯å¤§è§„æ¨¡æ•°æ®ï¼Œä¹Ÿå°½å¯èƒ½å°†æ•°æ®é›†åˆ†æˆå¤šä¸ªæ–‡ä»¶</li>
<li>å¯ä¸ºnodeå®šä¹‰labelï¼Œé”®å…¥å…³ç³»ä½œä¸ºå¯é€‰å‚æ•°</li>
</ul>
</blockquote>
<p><strong>å¯¹äºrelationshipsï¼Œéœ€è¦éµå¾ªä¸‹åˆ—ä¸‰æ¡è§„åˆ™</strong></p>
<ul>
<li>START_ID</li>
<li>END_ID</li>
<li>TYPE</li>
</ul>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://neo4j.com/docs/operations-manual/current/tutorial/neo4j-admin-import/">Neo4j Admin import</a></p>
</blockquote>
<pre><code class="language-bash">bin/neo4j-admin import --id-type=STRING --nodes import/executive.csv --nodes import/stock.csv --nodes import/concept.csv --nodes import/industry.csv --relationships import/executive_stock.csv --relationships import/stock_industry.csv --relationships import/stock_concept.csv
</code></pre>
<h2 id="å¯¼å…¥å·¥å…·æ¯”è¾ƒ">å¯¼å…¥å·¥å…·æ¯”è¾ƒ</h2>
<figure data-type="image" tabindex="4"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210710145416951.png" alt="" loading="lazy"></figure>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://weikeqin.com/2017/04/14/neo4j-import-data/">å…³äºneo4jå¯¼å…¥æ•°æ®å·¥å…·æ¯”è¾ƒ (æ³¨æ„ï¼šæ–‡ç« ç‰ˆæœ¬å¯èƒ½è¾ƒè€ï¼Œå¯¹äºæ–°ç‰ˆæœ¬å­˜åœ¨ä¸é€‚ç”¨çš„åœ°æ–¹) </a></p>
</blockquote>
<h2 id="load-csvä½¿ç”¨">LOAD CSVä½¿ç”¨</h2>
<pre><code class="language-CQL">:auto using periodic commit 200 load csv from &quot;file:///t.csv&quot; as linecreate (n:TA{id:line[0],address:line[1],height:line[2],index:line[3],txid:line[4],type:line[5]})//with HEADERS å¯ä»¥é¿å…è¯»å…¥header//ä½†æ˜¯ä¸èƒ½ä½¿ç”¨ :auto using periodic commit 200 
</code></pre>
<blockquote>
<p>æ³¨æ„äº‹é¡¹:</p>
<ul>
<li>è§£å†³åŠæ³•ï¼šåœ¨COMMONDå‰é¢åŠ ä¸Š:auto ï¼ˆä¸€èˆ¬ä½¿ç”¨<strong>using periodic commit</strong>ä¼šå‡ºç°ï¼‰</li>
</ul>
<figure data-type="image" tabindex="5"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210713174622970.png" alt="image-20210713174622970" loading="lazy"></figure>
<ul>
<li>è§£å†³åŠæ³•ï¼šå°†éœ€è¦å¯¼å…¥çš„csvæ–‡ä»¶ä¸Šä¼ è‡³**/neo4j-xx.x/import**ç›®å½•ä¸‹é¢</li>
</ul>
<figure data-type="image" tabindex="6"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210713174807411.png" alt="image-20210713174807411" loading="lazy"></figure>
</blockquote>
<h2 id="apocåŠ è½½jsonæ•°æ®">apocåŠ è½½jsonæ•°æ®</h2>
<pre><code class="language-cql">call apoc.load.json(&quot;file:///txt.json&quot;) yield valuemerge (n:TA{txid:value.txid})on create set n.height = value.height
</code></pre>
<p>merge ä¼šæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¯¥å±æ€§èŠ‚ç‚¹ï¼Œæ²¡æœ‰åˆ™åˆ›å»º</p>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="https://neo4j.com/labs/apoc/4.1/overview/apoc.load/apoc.load.json/">apocæ–‡æ¡£-apoc.load.json</a></p>
</blockquote>
<h2 id="cypherè¯­è¨€">Cypherè¯­è¨€</h2>
<pre><code class="language-CQL">#åˆ›å»ºèŠ‚ç‚¹create (a:person{name:&quot;&quot;,age:&quot;&quot;,gender:&quot;&quot; ... like:&quot;&quot;)#å»ºç«‹å…³ç³»match (a:Person),(b:Person) where a.like=&quot;football&quot; and b.like=&quot;tennis&quot; create (a)-[r:LOVE]-&gt;(b)#
</code></pre>
<blockquote>
<p>å‚è€ƒèµ„æ–™</p>
<p><a href="https://neo4j.com/docs/cypher-refcard/current/">å®˜æ–¹æ“ä½œä¸€è§ˆ</a></p>
</blockquote>
<h2 id="neo4jå°ç»†èŠ‚">Neo4jå°ç»†èŠ‚</h2>
<h3 id="neo4jèŠ‚ç‚¹ä¸æ˜¾ç¤ºé—®é¢˜">neo4jèŠ‚ç‚¹ä¸æ˜¾ç¤ºé—®é¢˜</h3>
<figure data-type="image" tabindex="7"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210714112202613.png" alt="" loading="lazy"></figure>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="http://neo4j.com.cn/topic/5c6f80c3cd4dafa110f1cf92">neo4jçš„å¯è§†åŒ–ç•Œé¢æ˜¾ç¤ºidä¸æ˜¾ç¤ºname?</a></p>
</blockquote>
<h3 id="å…³äºå¯¼å…¥å¯¼å‡ºçš„é—®é¢˜">å…³äºå¯¼å…¥å¯¼å‡ºçš„é—®é¢˜</h3>
<p><strong>ä¸€èˆ¬é‡‡ç”¨apocçš„loadCsvå‡½æ•°æˆ–è€…è‡ªå¸¦çš„LOAD CSVï¼Œå¯¹äºå…¶ä»–å¼€æºæ’ä»¶ä¸€èˆ¬ä¸è€ƒè™‘ï¼Œå› ä¸ºåŸºæœ¬æ²¡äººç»´æŠ¤</strong></p>
<figure data-type="image" tabindex="8"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210714134428565.png" alt="image-20210714134428565" loading="lazy"></figure>
<blockquote>
<p>å‚è€ƒé“¾æ¥:</p>
<p><a href="https://github.com/jexp/neo4j-shell-tools/issues/23">github_issue_export_csv</a></p>
</blockquote>
<h2 id="å¼€å‘æ„Ÿå—">ğŸˆå¼€å‘æ„Ÿå—</h2>
<ol>
<li>åœ¨springbootæ¡†æ¶ä¸­è¿ç”¨æœ‰ä¸¤ç§,ä¸€ä¸ªæ˜¯è‡ªå†™queryè¯­å¥ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ä½¿ç”¨Neo4jTemplate</li>
<li>åœ¨å¯¼å…¥å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œå¯¼å…¥csvè‚¯å®šæ˜¯æœ€ç®€å•å’Œæœ€å¿«çš„ï¼Œjsonä¹Ÿè¡Œã€‚ç½‘ä¸Šå¼€æºçš„neo4jæ’ä»¶åŸºæœ¬æ— äººç»´æŠ¤ï¼Œéƒ½æ˜¯å‡ å¹´å‰çš„ç‰ˆæœ¬ï¼Œä¸æ¨èä½¿ç”¨ã€‚</li>
<li>apocæ˜¯neo4jé‡Œé¢æœ€ä¸»æµçš„æ’ä»¶ï¼Œçµæ´»å¥½ç”¨</li>
<li></li>
</ol>
<p><a href="https://zhuanlan.zhihu.com/p/126219777">neo4jå¯è§†åŒ–</a></p>
<p><a href="neo4j.com.cn/topic/59b7aea3ae1b13da5cba6d7c">Neo4j å¯è§†åŒ– ï¼Œè‡ªå®šä¹‰å¯è§†åŒ–æ–¹æ¡ˆ</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ğŸ¥­mongodbå­¦ä¹ ]]></title>
        <id>https://Diomchen.github.io/post/mongodb-xue-xi/</id>
        <link href="https://Diomchen.github.io/post/mongodb-xue-xi/">
        </link>
        <updated>2021-07-19T11:28:27.000Z</updated>
        <content type="html"><![CDATA[<h2 id="dockerä¸­æŒ‚è½½mongodb">dockerä¸­æŒ‚è½½mongodb</h2>
<pre><code class="language-bash">docker run -p 27017:27017 -v /data/mongo:/data/db --name mongodb -d mongo
</code></pre>
<p>ç‰¹åˆ«æ³¨æ„ï¼šæŒ‚è½½çš„/data/dbç›®å½•å¿…é¡»è¦æœ‰ï¼Œå¹¶ç¡®ä¿è¯¥ç›®å½•æœ‰<strong>å†™</strong>æƒ</p>
<pre><code class="language-bash">mkdir -p /data/p
</code></pre>
<h2 id="quick-start">ğŸ’¨Quick Start</h2>
<h3 id="æ•°æ®åº“æ“ä½œ">æ•°æ®åº“æ“ä½œ</h3>
<pre><code class="language-bash"># æŸ¥çœ‹å½“å‰æŒ‡å‘æ•°æ®åº“
db

# CRUD
##  æ’å…¥(MAX_SIZE = 48MBp)
db.good.insert(&lt;æ–‡æ¡£&gt;)
### è‹¥æƒ³æ’å…¥å¤šæ¡æ•°æ®ï¼Ÿï¼ˆæ’å…¥é›†åˆï¼‰
post1 = {&quot;title&quot;:&quot;blog1&quot;,&quot;date&quot;:new Date()}
post2 = {&quot;title&quot;:&quot;blog2&quot;,&quot;date&quot;:new Date()}
post3 = {&quot;title&quot;:&quot;blog3&quot;,&quot;date&quot;:new Date()}
db.good.insert([
post1,post2,post3
])

## æŸ¥è¯¢
### æŸ¥ä¸€ä¸ª
db.good.findOne()
### findä¼šæ˜¾ç¤ºè‡³å¤š20æ¡æ•°æ®

## æ›´æ–°
### å¢åŠ å­—æ®µï¼ˆå¢åŠ è¯„è®ºå­—æ®µï¼‰
post.comments = []
### æ›´æ–°æ•°æ®
db.good.update({title:&quot;my blog update&quot;},post)

## åˆ é™¤
db.good.remove({title:&quot;my blog update&quot;})

</code></pre>
<h3 id="javaå¼€å‘ä¸­ä½¿ç”¨">Javaå¼€å‘ä¸­ä½¿ç”¨</h3>
<pre><code class="language-java">/*
* å¯¹äºmongodb-java-driver 3.7 ä»¥ä¸‹çš„ç‰ˆæœ¬é€‚ç”¨
*/

/**********************æ— éªŒè¯ç‰ˆæœ¬**********************/
// newä¸€ä¸ªmongoClient
MongoClient mongoClient = new MongoClient(&quot;&lt;host&gt;&quot;,&lt;port&gt;);

//è·å–mongoæ•°æ®åº“
MongoDatabase mongoDatabase = mongoClient.getDatabase(&quot;&lt;database_name&gt;&quot;);

/**********************æœ‰éªŒè¯ç‰ˆæœ¬**********************/
ServerAddress serverAddress = new ServerAddress(&quot;&lt;host&gt;&quot;,27017);
List&lt;ServerAddress&gt; addressList = new ArrayList&lt;&gt;();
addressList.add(serverAddress);

//mongoéªŒè¯
MongoCredential credential = MongoCredential.createScramSha1Credential(&quot;username&quot;,&quot;databaseName&quot;,&quot;password&quot;.toCharArray());

List&lt;MongoCredential&gt; credentials = new ArrayList&lt;&gt;();

credentials.add(credential);

MongoClient mongoClient = new MongoClient(addressList,credentials);

MongoDatabase mongoDatabase = mongoClient.getDatabase(&quot;databaseName&quot;);
System.out.println(&quot;Connect successfully&quot;);

/*
* å¯¹äºmongodb-java-driver 3.7 ä»¥ä¸Šçš„ç‰ˆæœ¬é€‚ç”¨
* ä»…ä»…æ˜¯è¿™ä¸¤å¤„çš„ä¸åŒ
*/

// è¿æ¥åˆ° mongodb æœåŠ¡
mongoClient = MongoClients.create(
    MongoClientSettings.builder()
    .applyToClusterSettings(builder -&gt;
                            builder.hosts(Arrays.asList(new ServerAddress(&quot;192.168.216.131&quot;))))
    .build());

// è¿æ¥åˆ°æ•°æ®åº“
mongoDatabase = mongoClient.getDatabase(&quot;testdb&quot;);

</code></pre>
<blockquote>
<p>Tips:</p>
<p><strong><s>å¯¹äºmongo3.7ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œjavaä¸­å¯¹mongoçš„APIå®Œå…¨ä¸åŒ</s></strong></p>
<p><s>è‹¥æ˜¯å¯¹ 3.7 ä»¥ä¸Šçš„ç‰ˆæœ¬é‡‡ç”¨æ–°APIï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥nullpointé”™è¯¯</s></p>
<p>ä¸»è¦æ˜¯è¦åŒºåˆ† com.mongodb.MongoClient(ç±») å’Œ  com.mongodb.client.MongoClient æ˜¯æ¥å£ã€‚</p>
<p><strong>æŠ¥ because there was a socket exception raised by this connection. é”™è¯¯æ˜¯å› ä¸ºæ•°æ®é‡å¤ªå¤§ï¼Œè¯»ä¸å‡ºæ¥</strong></p>
<p><strong>è¿˜æœ‰å¯èƒ½å°±æ˜¯æœªæˆæƒymlé…ç½®éœ€è¦é‡‡ç”¨ authentication-database: admin è¿›è¡Œæˆæƒ</strong></p>
<figure data-type="image" tabindex="1"><img src="C:%5CUsers%5Cthgy%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210709151856862.png" alt="" loading="lazy"></figure>
</blockquote>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="http://mongodb.github.io/mongo-java-driver/4.2/driver/getting-started/quick-start/">mongoDB JVM Driversï¼ˆ4.2ï¼‰æ–‡æ¡£</a></p>
<p><a href="http://mongodb.github.io/mongo-java-driver/3.9/javadoc/?com/mongodb/client/MongoClient.html">mongo-java-APIæ–‡æ¡£</a></p>
<p><a href="https://blog.csdn.net/u011466470/article/details/84673761">å…³äº socket exception rised é”™è¯¯</a></p>
<p><a href="https://www.bilibili.com/video/BV1264y1v77R?p=24">é‡‡ç”¨ authentication-database: admin è¿›è¡Œæˆæƒé—®é¢˜( è§†é¢‘ )</a></p>
</blockquote>
<h3 id="mongoç´¢å¼•æŸ¥è¯¢">mongoç´¢å¼•æŸ¥è¯¢</h3>
<pre><code class="language-java">    /**
     * @title getTxByAddress
     * @description é€šè¿‡åœ°å€æ‰¾äº¤æ˜“
     * @author DiomChen
     * @updateTime 2021/7/12 17:55
     * @throws
     * @æµ‹è¯•æ•°æ®ï¼š
     *      17yYyafrfiaaVJGcaeQdpAeHdcBQSKAuLD
     */
    @Test
    public void getTxByAddress(){
        Query query = new Query(Criteria
                .where(&quot;address&quot;).is(&quot;17yYyafrfiaaVJGcaeQdpAeHdcBQSKAuLD&quot;));
        List&lt;Addresstxs&gt; addresstxsList = mongoTemplate.find(query,Addresstxs.class);
        String txid = addresstxsList.get(0).getTxid();
        Query query1 = new Query(Criteria
        .where(&quot;txid&quot;).is(txid));
        System.out.println(mongoTemplate.find(query1,Transactions.class));
    }
</code></pre>
<h4 id="æ— ç´¢å¼•">æ— ç´¢å¼•</h4>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210712185013822.png" alt="image-20210712185013822" loading="lazy"></figure>
<h4 id="ä»¥addresså»ºç«‹ç´¢å¼•">ä»¥addresså»ºç«‹ç´¢å¼•</h4>
<figure data-type="image" tabindex="3"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210712191003692.png" alt="image-20210712191003692" loading="lazy"></figure>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="https://blog.csdn.net/weixin_41127890/article/details/105536297">SpringBoot2ä½¿ç”¨mongoTemplateåˆ›å»ºé›†åˆå¹¶æ·»åŠ ç´¢å¼•</a></p>
<p><a href="https://www.cnblogs.com/williamjie/p/9297670.html">MongoDBç´¢å¼•ç®¡ç†ï¼ç´¢å¼•çš„åˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤</a></p>
<p><a href="https://www.cnblogs.com/dataoblogs/p/14121911.html">åœ¨MongoDBä¸­æ‰§è¡ŒæŸ¥è¯¢ä¸åˆ›å»ºç´¢å¼•</a></p>
</blockquote>
<h2 id="åŸºæœ¬å†…å®¹">åŸºæœ¬å†…å®¹</h2>
<ul>
<li>æ–‡æ¡£ï¼šå¯¹åº”å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡Œï¼Œä½†æ˜¯å†…éƒ¨æœ‰é¡ºåº</li>
<li>é›†åˆï¼šå¯¹åº”å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼Œæ˜¯æœ‰å¤šä¸ªæ–‡æ¡£ç»„æˆï¼Œå¯¹äºæ–‡æ¡£å†…éƒ¨ä¸å…³å¿ƒï¼ˆåŠ¨æ€æ¨¡å¼ï¼‰</li>
</ul>
<h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2>
<ul>
<li>null ï¼š{&quot;x&quot; : null}</li>
<li>å¸ƒå°”ï¼š{&quot;x&quot; : false}</li>
<li>æ•°å€¼ï¼š{&quot;x&quot;:3}</li>
<li>å­—ç¬¦ä¸²ï¼š{&quot;x&quot;:&quot;str&quot;}</li>
<li>æ—¥æœŸï¼š{&quot;x&quot;:new Date()}</li>
<li>æ­£åˆ™è¡¨è¾¾å¼ï¼š{&quot;x&quot;:/foobar/i}</li>
<li>æ•°ç»„ï¼š{&quot;x&quot;:[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]}</li>
<li>å†…åµŒæ–‡æ¡£ï¼š{&quot;x&quot;:{&quot;foo&quot;,&quot;bar&quot;}}</li>
<li>å¯¹è±¡idï¼š{&quot;x&quot;:ObjectId()}</li>
<li>äºŒè¿›åˆ¶æ•°æ®ï¼š{&quot;x&quot;:}</li>
<li>ä»£ç ï¼š{&quot;x&quot;:function(){/*     */}}</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ğŸ§¶neo4jæ–‡æ¡£æ•´ç†]]></title>
        <id>https://Diomchen.github.io/post/neo4j-wen-dang-zheng-li/</id>
        <link href="https://Diomchen.github.io/post/neo4j-wen-dang-zheng-li/">
        </link>
        <updated>2021-07-19T11:26:36.000Z</updated>
        <content type="html"><![CDATA[<h2 id="1-ç¯å¢ƒéƒ¨ç½²æ–¹é¢">1. ğŸ› ç¯å¢ƒéƒ¨ç½²æ–¹é¢</h2>
<h4 id="11-ç‰ˆæœ¬é€‰æ‹©">1.1 ç‰ˆæœ¬é€‰æ‹©</h4>
<p>å¯¹äºneo4jç‰ˆæœ¬æ–¹é¢ï¼Œ3.x å¯¹åº” Java8ï¼Œ4.x å¯¹åº” Java11ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210708104701348.png" alt="" loading="lazy"></figure>
<p>ç°åœ¨87å’Œ88æœºå™¨ä¸Šä½¿ç”¨çš„éƒ½æ˜¯4.xç‰ˆæœ¬ã€‚</p>
<h4 id="12-éƒ¨ç½²">1.2 éƒ¨ç½²</h4>
<h5 id="dockerä¸­éƒ¨ç½²"><strong>ğŸ‹dockerä¸­éƒ¨ç½²</strong></h5>
<p>æ‹‰å– neo4j é•œåƒï¼ŒæŒ‡å®š 7474ï¼Œ7687 ç«¯å£çš„æ˜ å°„ã€‚</p>
<p><font color="green">ä½†æ˜¯ä¸€å®šè¦æŒ‡å®šimportå’Œdataæ˜ å°„æ–‡ä»¶å¤¹</font></p>
<h5 id="æœåŠ¡å™¨ç›´æ¥éƒ¨ç½²">ğŸ–¥<strong>æœåŠ¡å™¨ç›´æ¥éƒ¨ç½²</strong></h5>
<p>ä¸‹è½½è§£å‹ceç‰ˆæœ¬</p>
<p>æ›´æ”¹/conf/neo4j.confæ–‡ä»¶ï¼Œä¹‹åå¯åŠ¨ ./bin/neoj</p>
<pre><code class="language-shell"># With default configuration Neo4j only accepts local connections.
# To accept non-local connections, uncomment this line:

#ç‰¹åˆ«æ³¨æ„ï¼šé»˜è®¤æ˜¯æ³¨é‡Šçš„ï¼Œä¸å¼€å¯ï¼Œå¤–ç½‘ä¸èƒ½è®¿é—®webç«¯å£neo4j
dbms.default_listen_address=0.0.0.0

# You can also choose a specific network interface, and configure a non-default
# port for each connector, by setting their individual listen_address.

# The address at which this server can be reached by its clients. This may be the server's IP address or DNS name, or
# it may be the address of a reverse proxy which sits in front of the server. This setting may be overridden for
# individual connectors below.
#dbms.default_advertised_address=localhost

# You can also choose a specific advertised hostname or IP address, and
# configure an advertised port for each connector, by setting their
# individual advertised_address.

# By default, encryption is turned off.
# To turn on encryption, an ssl policy for the connector needs to be configured
# Read more in SSL policy section in this file for how to define a SSL policy.

# Bolt connector
dbms.connector.bolt.enabled=true
#dbms.connector.bolt.tls_level=DISABLED
dbms.connector.bolt.listen_address=0.0.0.0:7687
#dbms.connector.bolt.advertised_address=:7687

# HTTP Connector. There can be zero or one HTTP connectors.
dbms.connector.http.enabled=true
dbms.connector.http.listen_address=0.0.0.0:7474
#dbms.connector.http.advertised_address=:7474

# HTTPS Connector. There can be zero or one HTTPS connectors.
dbms.connector.https.enabled=false
dbms.connector.https.listen_address=0.0.0.0:7473
#dbms.connector.https.advertised_address=:7473
</code></pre>
<h2 id="2-javaå¼€å‘æ–¹é¢">2. â˜•javaå¼€å‘æ–¹é¢</h2>
<h4 id="21-è®¾ç½®é©±åŠ¨å¯åŠ¨">2.1 è®¾ç½®é©±åŠ¨å¯åŠ¨</h4>
<p>ä¸æ¨èï¼Œæ¨èspringbootçš„è‡ªåŠ¨é…ç½®</p>
<pre><code class="language-java">//è®¾ç½®driver
Driver driver = GraphDatabase.driver(&quot;bolt://192.168.216.131:7687&quot;, AuthTokens.basic(&quot;neo4j&quot;, &quot;123456&quot; ));

//æ‰“å¼€session
Session session = driver.session();

//æ‰§è¡Œè¯­å¥
String cql = &quot;create (n:Person{name:$name,title:$title})&quot;;
            String insert_test_str = session.writeTransaction(new TransactionWork&lt;String&gt;() {
                @Override
                public String execute(Transaction tx) {
                    Result result = tx.run(cql,parameters(&quot;name&quot;,&quot;diomchen&quot;,&quot;title&quot;,&quot;The Code Hero&quot;));
                    return &quot;Create Node OK!&quot;;
                }
            });

//å…³é—­session
session.close();

//å…³é—­driver
driver.close();
</code></pre>
<h4 id="22-springbootè‡ªåŠ¨é…ç½®">2.2 springbootè‡ªåŠ¨é…ç½®</h4>
<pre><code class="language-yml">#ymlåŸºæœ¬é…ç½®
    neo4j:
      uri: bolt://&lt;host&gt;:7687
      username: neo4j
      password: 123456
</code></pre>
<h5 id="é€šè¿‡cypherè¯­å¥å®ç°æ“ä½œ"><strong>é€šè¿‡cypherè¯­å¥å®ç°æ“ä½œ</strong></h5>
<p>neo4jå¯¹è±¡ï¼š</p>
<pre><code class="language-java">@Data
@Node(labels = {&quot;Addresstxs&quot;})
public class NAddresstxs {
//    //è‡ªåŠ¨ç”Ÿæˆid
//    @Id @GeneratedValue
//    private Long id;

    //äº¤æ˜“åœ°å€è¡¨Id
    @Id
    private String addresstxsId;

    //äº¤æ˜“åœ°å€
    @Property(name =&quot;address&quot;)
    private String address;
</code></pre>
<p>repositoryï¼š</p>
<pre><code class="language-java">@Repository
public interface AddresstxsRepository extends Neo4jRepository&lt;NAddresstxs,String&gt; {

    @Query(&quot;create (n:Addresstxs{ addresstxsId:$addresstxsId , address:$address , type:$type}) return n&quot;)
    List&lt;NAddresstxs&gt; addAddresstxs(@Param(&quot;addresstxsId&quot;) String addresstxsId, @Param(&quot;address&quot;) String address, @Param(&quot;type&quot;) Integer type);

    @Query(&quot;match (n) return n&quot;)
    List&lt;NAddresstxs&gt; getAddresstxs();
    /*
    	ç‰¹åˆ«éœ€è¦æ³¨æ„è¿”å›çš„ç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥ä»¥ä¸‹é—®é¢˜
    */
}
</code></pre>
<p><strong><font color="green">org.springframework.data.mapping.MappingException: The schema already contains a node description under the primary label Addresstxs</font></strong></p>
<p>cypherè¯­å¥åœ¨ 3.x å’Œ 4.x ä¸­æœ‰æ‰€ä¸åŒ</p>
<pre><code class="language-java">//javaä¸­cql(3.x)
String cql = &quot;create (n:Person{name:{name},title:{title}})&quot;;

//javaä¸­cql(4.x)
String cql = &quot;create (n:Person{name:$name,title:$title})&quot;;
</code></pre>
<h5 id="é€šè¿‡neo4jtemplate"><strong>é€šè¿‡Neo4jTemplate</strong></h5>
<p>pom:</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-neo4j&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>æ³¨å…¥:</p>
<pre><code class="language-java">@Resource
Neo4jTemplate neo4jTemplate;
</code></pre>
<p>å…¶å®å’Œ MongoTemplate æ“ä½œä¸€æ ·ï¼Œéƒ½æ˜¯saveï¼Œfindç­‰ç­‰ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒè‡ªå®šæ¡ä»¶ã€‚</p>
<h2 id="3-æ•°æ®å¯¼å…¥neo4jæ•°æ®åº“æ–¹é¢">3. ğŸ’¾æ•°æ®å¯¼å…¥Neo4jæ•°æ®åº“æ–¹é¢</h2>
<p><mark>å¯¼å…¥æ•°æ®åˆ°neo4jæ˜¯æœ€å½±å“ä½¿ç”¨ä½“éªŒçš„ã€‚</mark></p>
<h4 id="31-å¯¼å…¥æ–¹å¼æ¯”è¾ƒ">3.1 å¯¼å…¥æ–¹å¼æ¯”è¾ƒ</h4>
<p>åŸºæœ¬æ–¹å¼å¯ä»¥è§ä¸‹å›¾ï¼Œä½†æ˜¯ç°åœ¨å¯ç”¨çš„åªæœ‰<strong>createè¯­å¥ï¼Œload csvè¯­å¥ï¼Œapocæ’ä»¶</strong>ï¼Œå…¶ä»–çš„åŸºæœ¬å› ä¸ºç¼ºå°‘ç»´æŠ¤è€ŒåºŸç”¨ã€‚</p>
<p>ç¬¬ä¸€ç§ create è¯­å¥ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸ä¹‹æ…¢ï¼Œå®é™…ä½¿ç”¨è¿œä½äºä¸‹å›¾çš„1000/sé€Ÿåº¦ã€‚</p>
<p>ç¬¬äºŒç§ load csv è¯­å¥ï¼Œä¹Ÿæ˜¯ç°åœ¨ç”¨çš„ï¼Œ3k+ èŠ‚ç‚¹å’Œ12k+ å…³ç³» å¯¼å…¥èŠ±äº† 30 åˆ†é’Ÿå·¦å³ ã€‚</p>
<p>ä½†æ˜¯ç½‘ä¸Šæœ‰<a href="https://zhuanlan.zhihu.com/p/90691645">åˆ›å»ºçº¦æŸ</a>çš„æ–¹æ³•è§£å†³ï¼Œä¹Ÿæœ‰é€šè¿‡æ·»åŠ **:auto using periodic commit 200** æ§åˆ¶æäº¤é¢‘ç‡çš„æ–¹å¼æ¥æé«˜å¯¼å…¥é€Ÿåº¦ï¼Œè¿™äº›éƒ½è¿˜æœªå°è¯•è¿‡ã€‚</p>
<p>æœ€åä¸€ç§ apoc æ’ä»¶å¯¼å…¥ï¼Œè¿˜æœªä½¿ç”¨ï¼Œæš‚ä¸åšè¯„ä»·ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/Diomchen/PiCor/image-20210710145416951.png" alt="" loading="lazy"></figure>
<h4 id="32-csvæ•°æ®åˆ›å»ºå’Œå¯¼å…¥">3.2 CSVæ•°æ®åˆ›å»ºå’Œå¯¼å…¥</h4>
<h5 id="csvè§„èŒƒ"><strong>ğŸ“ƒCSVè§„èŒƒ</strong></h5>
<p>Relationshipsè§„èŒƒ</p>
<ul>
<li>START_ID</li>
<li>END_ID</li>
<li>TYPE</li>
</ul>
<p>æ‰€ä»¥å¯¹äºNodeå°±éœ€è¦æœ‰èƒ½å¤Ÿå»ºç«‹å…³ç³»çš„æ ‡è¯†æ€§å±æ€§ã€‚</p>
<p><em>cypher è¯­å¥å®é™…ä½¿ç”¨ä¸­ï¼Œå¯¹äº TYPE å±æ€§ä¹Ÿå¹¶éç¡¬æ€§è¦æ±‚ã€‚</em></p>
<h5 id="csvåˆ›å»ºä¸å¯¼å‡º"><strong>â›“CSVåˆ›å»ºä¸å¯¼å‡º</strong></h5>
<ol>
<li>javaå…ˆä»mongoä¸­è¯»å–æ‰€éœ€æ•°æ®</li>
<li>åˆ›å»ºå¯¼å‡ºcsvæ‰€éœ€å±æ€§çš„å¯¹è±¡</li>
<li>åˆ©ç”¨fastjsonæ’ä»¶ï¼Œå°†å¯¹è±¡åˆ—è¡¨è½¬æˆjsonå­—ç¬¦ä¸²</li>
<li>åˆ©ç”¨jacksonæ’ä»¶ï¼Œå°†jsonå­—ç¬¦ä¸²è½¬æˆcsv</li>
<li>å¯¼å‡ºcsvæ–‡ä»¶</li>
</ol>
<p>å·¥å…·ç±»ï¼š</p>
<pre><code class="language-java">    //å¯¹è±¡åˆ—è¡¨è½¬csv    public static&lt;T&gt; void Object2Csv(List&lt;T&gt; objectList,String savePath) throws IOException {        JSONArray jsonArray = new JSONArray();        jsonArray.addAll(objectList);        String ss = jsonArray.toJSONString();        JsonNode jsonNode = new ObjectMapper().readTree(ss);        CsvSchema.Builder csvSchemaBuild = CsvSchema.builder();        JsonNode fObject = jsonNode.elements().next();        fObject.fieldNames().forEachRemaining(fieldName -&gt; {csvSchemaBuild.addColumn(fieldName);});        CsvSchema csvSchema = csvSchemaBuild.build().withHeader();        OutputStreamWriter ow = new OutputStreamWriter(new FileOutputStream(new File(savePath)),&quot;gbk&quot;);        CsvMapper csvMapper = new CsvMapper();        csvMapper.writerFor(JsonNode.class)                .with(csvSchema)                .writeValue(ow, jsonNode);    }        //å¯¹è±¡åˆ—è¡¨è½¬json    public static &lt;T&gt; void Object2Json(List&lt;T&gt; objectList,String savePath) throws IOException {        JSONArray jsonArray = new JSONArray();        jsonArray.addAll(objectList);        String ss = jsonArray.toJSONString();        save(ss,savePath);    }    private static void save(String jsonstr,String filename) throws IOException {        OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream(filename), &quot;gbk&quot;);        osw.write(jsonstr);        osw.flush();        osw.close();    }
</code></pre>
<h5 id="csvå¯¼å…¥"><strong>ğŸ§£CSVå¯¼å…¥</strong></h5>
<p>åªå°è¯•è¿‡é‡‡ç”¨LOAD CSVè¯­å¥çš„å¯¼å‡ºæ–¹å¼ã€‚</p>
<pre><code class="language-java">    @Query(&quot;load csv with HEADERS from \&quot;file:///addrN.csv\&quot; as line merge (n:Address{address:line.address}) &quot;)    void optInAddAddressNode();
</code></pre>
<p><em>merge</em> çš„å¥½å¤„ï¼Œå®ƒä¼šåˆ¤æ–­åº“é‡Œé¢æ˜¯å¦ä»¥åŠå­˜åœ¨è¯¥ç›¸åŒèŠ‚ç‚¹ï¼Œè‹¥æœ‰ï¼Œåˆ™ä¸ä¼šåˆ›å»ºï¼Œåä¹‹ï¼Œåˆ™ä¼šåˆ›å»ºæ–°èŠ‚ç‚¹ã€‚è¿™æ ·å°±é¿å…äº†åº“é‡Œé¢å­˜åœ¨å¤šä¸ªé‡å¤èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://blog.csdn.net/mathew_leung/article/details/101838350">centos7 æœåŠ¡å™¨å®‰è£…neo4jå¹¶å®ç°è¿œç¨‹è®¿é—®</a></p>
<p><a href="https://neo4j.com/docs/operations-manual/current/tutorial/neo4j-admin-import/">Neo4j Admin import</a></p>
<p><a href="https://neo4j.com/labs/apoc/4.2/overview/apoc.algo/">apocæ–‡æ¡£</a></p>
</blockquote>
]]></content>
    </entry>
</feed>